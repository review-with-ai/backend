# âœ…API ëª…ì„¸

<a href="http://dev.api.ai-review.site/swagger-ui/index.html"> API ëª…ì„¸ </a>

# ì‚¬ìš© ìŠ¤íƒ

# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

# í”„ë¡œì íŠ¸ êµ¬ì¡°

ë©€í‹° ëª¨ë“ˆ êµ¬ì¡°ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

# í”„ë¡œì íŠ¸ ì‹¤í–‰í•˜ê¸°

## app-api í”„ë¡œì íŠ¸ ì‹¤í–‰í•˜ê¸°

1. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™

```shell
cd {project-directory}
```

2. í”„ë¡œì íŠ¸ ë¹Œë“œí•˜ê¸°

```shell
./gradlew :app-api
```

3. í”„ë¡œì íŠ¸ ì‹¤í–‰í•˜ê¸°

```shell
java -jar -Dspring.profiles.active=local  app-api/build/libs/app-api-0.0.1-SNAPSHOT.jar
```

- í”„ë¡œì íŠ¸ ì‹¤í–‰ ì „ì— mysqlì´ ì‹¤í–‰ë˜ì–´ ìˆì–´ì•¼í•œë‹¤.
- ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹œì—ëŠ” dockerë¥¼ ì‚¬ìš©í•´ mysqlì„ ì‹¤í–‰í•œë‹¤. ì‹¤í–‰ë°©ë²•ì€ [ë¡œì»¬ì—ì„œ dockerë¡œ MYSQL ì»¨í…Œì´ë„ˆ ë„ìš°ê¸°](#ë¡œì»¬ì—ì„œ-dockerë¡œ-mysql-ì»¨í…Œì´ë„ˆ-ë„ìš°ê¸°) ì°¸ê³ .

# API ì„¤ê³„ ê·œì¹™

- URLì„ êµ¬ì„±í•  ë•Œ ë§¨ ì•ì— ë²„ì „ì„ ëª…ì‹œí•œë‹¤ ex) /api/v1/...
- ì—¬ëŸ¬ ë‹¨ì–´ë¡œ êµ¬ì„±ëœ ê²½ìš° dashë¥¼ ì‚¬ìš©í•œë‹¤ ex) /api/v1/review-cards
- URLì˜ Entityë¥¼ ë‚˜íƒ€ë‚´ëŠ” êµ¬ë¬¸ì€ ë³µìˆ˜í˜•ìœ¼ë¡œ í•œë‹¤ ex) /api/v1/articles
- ì¡°íšŒ ì¡°ê±´ì€ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•œë‹¤ ex) /api/v1/user/1/review-cards?state=done
- ë¦¬ì†ŒìŠ¤ ë§Œìœ¼ë¡œ íŠ¹ì • ë™ì‘ì„ ë‚˜íƒ€ë‚´ê¸° ì–´ë ¤ìš¸ë•Œ íŠ¹ì • í–‰ìœ„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë‹¨ì–´ë¥¼ urlì— ì¶”ê°€í•˜ëŠ” ê²ƒì„ í—ˆìš©í•œë‹¤.
    - ex) api/v1/user/review-cards/share
    - GET, POST, PUT, DELETE ë¡œ ì²˜ë¦¬í•˜ê¸° ì• ë§¤í•œ ê²½ìš° Control-URLë¥¼ ì‚¬ìš©í•œë‹¤.
- ëª¨ë“  ì„±ê³µí•œ ì‘ë‹µì€ HTTP Status 200ì„ ë³´ë‚¸ë‹¤.
- ëª¨ë“  ì‹¤íŒ¨í•œ ì‘ë‹µì€ HTTP Statusë¡œ ì‹¤íŒ¨ë¥¼ ë‚˜íƒ€ë‚´ê³ , http ë©”ì‹œì§€ bodyì— ì—ëŸ¬ ì½”ë“œì™€ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë‹´ì•„ì„œ ìƒì„¸í•œ ë‚´ìš©ì„ ì „ë‹¬í•œë‹¤.
    ```json
    {
      "errorCode" : "RESOURCE_NOT_FOUND",
      "errorMessage" : "ìœ ì € id = 1000 ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
    }
    ```
    - ë‹¨, ì¸ì¦ì´ ì‹¤íŒ¨í•˜ì˜€ì„ ë•ŒëŠ” ```HTTP 401 Unauthorized``` ì—ëŸ¬ê°€ ë°˜í™˜ë˜ê³ , ì—ëŸ¬ ë©”ì‹œì§€ëŠ” ì „ë‹¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
- PUT ë©”ì†Œë“œëŠ” ì „ì²´ ë¦¬ì†ŒìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í• ë•Œ ì‚¬ìš©í•˜ê³ , PATCH ë©”ì†Œë“œëŠ” ë¦¬ì†ŒìŠ¤ì˜ ì¼ë¶€ë¥¼ ì—…ë°ì´íŠ¸í• ë•Œ ì‚¬ìš©í•œë‹¤.
- PATCH ë©”ì†Œë“œë¡œ íŠ¹ì • í•„ë“œë¥¼ ì—…ë°ì´íŠ¸ í• ë•Œ, ìˆ˜ì •í•  í•„ë“œë§Œ http ë©”ì‹œì§€ ë°”ë””ì— ë‹´ì•„ì„œ ìš”ì²­í•˜ê³ , ê°’ì´ ìˆëŠ” í•„ë“œë§Œ ìˆ˜ì •í•œë‹¤.
- ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë‚˜ http ë©”ì‹œì§€ ë°”ë””ë¡œ ì „ë‹¬ë˜ëŠ” ë°ì´í„°ì˜ ìœ íš¨ì„±ì€ dtoì—ì„œ ì²´í¬í•˜ì—¬ ë¹ ë¥´ê²Œ ì‹¤íŒ¨í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.
    - ìœ íš¨ì„± ê²€ì¦ì— ì‹¤íŒ¨í•œ ê²½ìš° 400 BAD REQUESTë¥¼ ì „ë‹¬í•œë‹¤.
- DELETE ë©”ì†Œë“œëŠ” ë©±ë“±ì„±ì„ ê°€ì§€ë„ë¡ íŠ¹ì • ìì›ì„ ì§€ì •í•´ì„œ ì§€ìš°ë„ë¡ í•œë‹¤(/api/v1/users/1ê°€ëŠ¥. /api/v1/users/last ë¶ˆê°€ëŠ¥.)
- API ìš”ì²­ ê²°ê³¼ê°€ ì—¬ëŸ¬ê°œì˜€ì„ë•Œ ê·¸ ìµœëŒ€ limitì„ ì§€ì •í•´ì•¼í•œë‹¤.
    - limitì„ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ë°›ê³ , ì„œë²„ì—ì„œ limitìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆëŠ” ê°’ì˜ ë²”ìœ„ë¥¼ ì§€ì •í•œë‹¤.
    - limitì´ nullì¼ ê²½ìš°ì˜ ë””í´íŠ¸ ê°’ì„ ì§€ì •í•´ë‘”ë‹¤.
- ì¸ì¦ì´ í•„ìš”í•œ APIì˜ ê²½ìš° /api/v1/account/authë¥¼ í†µí•´ ì¸ì¦ í›„ ì‘ë‹µë°›ì€ tokenì„ headerì— í¬í•¨í•œ ìš”ì²­ë§Œ ì²˜ë¦¬ê°€ ëœë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ```HTTP 401 unauthorized```
  ì—ëŸ¬ê°€ ë°˜í™˜ëœë‹¤.

## ì¸ì¦

- /api/v1/account/loginì„ í†µí•´ ë¡œê·¸ì¸ì„ ìš”ì²­í•˜ë©´ username, passwordë¥¼ ì‚¬ìš©í•´ ë¡œê·¸ì¸í•œ í›„ jwt í† í°ì„ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜í•œë‹¤.
- ì¸ì¦ ì‚¬ìš©ììš© APIë¥¼ í˜¸ì¶œí• ë•ŒëŠ” ìš”ì²­ í—¤ë”ì— X-AIREVIEW-AUTH í•­ê³°ì„ ì¶”ê°€í•˜ê³ , ê°’ìœ¼ë¡œ ë¡œê·¸ì¸ í›„ ì „ë‹¬ë°›ì€ `token`ì— `Bearer` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ ì…ë ¥í•œë‹¤.
    - JwtAuthenticationTokenFilterëŠ” HTTP ìš”ì²­ í—¤ë”ì—ì„œ JWT ê°’ì„ ì¶”ì¶œí•˜ê³  í•´ë‹¹ ê°’ì´ ì˜¬ë°”ë¥´ë‹¤ë©´ ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´(JwtAuthenticationToken)ì„

```json
curl --request GET 'http://localhost:8080/api/v1/users/me' \
--header 'Accept: application/json' \
--header 'X-PRGRMS-AUTH: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9
```

- ì¸ì¦ ì‚¬ìš©ììš© API í˜¸ì¶œì‹œ ```X-AIREVIEW_AUTH``` í—¤ë”ê°€ ëˆ„ë½ë˜ê±°ë‚˜ ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê²½ìš° 401 UnAuthorized ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤.

# ì½”ë”© ì»¨ë²¤ì…˜

- POSIXë¥¼ ì¤€ìˆ˜í•˜ê¸° ìœ„í•´ ëª¨ë“  íŒŒì¼ ëì— newlineì„ ì¶”ê°€í•˜ë„ë¡ í•œë‹¤.
    - intellij ì„¤ì • ``General > Editor > ensure every saved file ends with a line break``` ì„ í†µí•´ ì‹¤ìˆ˜ë¥¼ ë°©ì§€í•œë‹¤.

# ğŸ” ê°œë°œ ê³¼ì •

# ê¸°íƒ€

## ë¡œì»¬ì—ì„œ dockerë¡œ MYSQL ì»¨í…Œì´ë„ˆ ë„ìš°ê¸°

- ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ dockerë¥¼ ì‚¬ìš©í•´ mysql ì»¨í…Œì´ë„ˆë¥¼ ë„ìš´ë‹¤.

1. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™

```shell
cd {project-directory}
```

2. ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```shell
docker-compose up -d
```

- mysql databaseë¥¼ ìœ„í•œ volumeì„ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ë‚´ì— ìƒì„±í•œë‹¤.
- ai_review ë°ì´í„°ë² ì´ìŠ¤ê°€ ë§Œë“¤ì–´ì§€ê³  username `review` password `review`ë¡œ ì ‘ì† ê°€ëŠ¥í•˜ë‹¤.
- ë„ì›Œì§„ ì»¨í…Œì´ë„ˆì— ì ‘ì†í•´ì„œ userê°€ ì œëŒ€ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆë‹¤.

3. ì ‘ì† í™•ì¸í•˜ê¸°

```shell
docker exec -it mysql-container bash
mysql -u review -p review
```

## ë¡œì»¬ì—ì„œ dockerë¡œ nGrinder ì»¨í…Œì´ë„ˆ ë„ìš°ê¸°

- ë¡œì»¬ì—ì„œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ dockerë¥¼ ì‚¬ìš©í•´ nGrinder controller ë° agent 1ê°œë¥¼ ë„ìš´ë‹¤.

1. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™

```shell
cd {project-directory}
```

2. nGrinder controller ë° 1ê°œ agent ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```shell
docker-compose up -d
```

- http://localhost:8880 ìœ¼ë¡œ nGrinder controller UIì— ì ‘ì†í•  ìˆ˜ ìˆë‹¤.
- ê¸°ë³¸ ê³„ì •ì€ username `admin` password `admin' ì´ë‹¤.
- ë§Œì•½ agent ì»¨í…Œì´ë„ˆê°€ `connection refused` ì—ëŸ¬ê°€ ë‚˜ë©° controllerì— ì—°ê²°ë˜ì§€ ëª»í•œ ì±„ ì¢…ë£Œëœë‹¤ë©´, amd ë¬¸ì œ ì¼ ìˆ˜ ìˆë‹¤(mac m1 ë“± amd ì¹© ì‚¬ìš© ê²½ìš°). ì´ ê²½ìš°ì—ëŠ”
  nGrinderì˜ agentë¥¼ ì§ì ‘ ì‹¤í–‰í•œë‹¤.

``` 
./ngrinder-agent/run_agent.sh
```

